<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
    <title>Current track</title>
        <link rel="stylesheet"  type="text/css" href="{{ MEDIA_URL }}screen.css" />
        <script type="text/javascript" src="{{ MEDIA_URL }}jquery-1.5.2.min.js"></script>
        <script type="text/javascript" src="{{ MEDIA_URL }}jquery.timers-1.2.js"></script>
        <script type="text/javascript" src="{{ MEDIA_URL }}falling-pieces.js"></script>
        <script type="text/javascript">
            /* Function that updates the capacities */
            var get_last_track = function() {
                $( '#last_track' ).load(
                        '{% url tracks.views.get_last_track %}');
            };
            var get_now_playing = function() {
                $( '#now_playing' ).load(
                    '{% url tracks.views.get_now_playing %}', function() {
                            if( is_tetris_song() ) {
                                play_tetris();
                            } else {
                                dont_play_tetris();
                            }
                            });
            };
            /* Initial update */
            $( document ).ready( get_last_track );
            $( document ).ready( get_now_playing );
            /* Start timers updating a screen resource. */
            $( document ).everyTime('10s', get_last_track );
            $( document ).everyTime('10s', get_now_playing );

            /* Ajax spinner */
            $( document ).ajaxStart( function() {
                $( '#spinner' ).show();
                }).ajaxStop( function() {
                    $( '#spinner' ).hide();
                    });
        </script>
    </head>

    <body>
        <div id="spinner"><img src="{{ MEDIA_URL }}spinner.gif"/></div>
        <div id="container">
            <div id="content">
                <div id="now_playing"></div>
                <div id="last_track"></div>
            </div>
        </div>
        <div id="gameContainer">
            <div id="brickContainer"></div>
        </div>

    </body>
</html>
